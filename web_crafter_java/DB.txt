DROP DATABASE IF EXISTS web_crafter;
CREATE DATABASE web_crafter;
USE web_crafter;

CREATE TABLE userWeb (
    id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT 'PK'
    , userId INT UNSIGNED NOT NULL COMMENT 'FK'                              
    , title VARCHAR(100) NOT NULL COMMENT '제목'
    , pycode LONGTEXT NOT NULL COMMENT '파이썬 코드'
    , hit INT NOT NULL DEFAULT 0 COMMENT '조회수'
    , regDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '작성일'
    , updateDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '수정일'
    , INDEX (userId)
    , CONSTRAINT fk_userWeb_userId 
      FOREIGN KEY (userId) REFERENCES `user`(id)
      ON DELETE CASCADE  -- 유저가 탈퇴하면 해당 유저의 웹 프로젝트도 같이 삭제
      ON UPDATE CASCADE  -- 유저 ID가 바뀌면 같이 바뀜
);

CREATE TABLE `user` (
    id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT 'PK'
    , `name` VARCHAR(50) NOT NULL COMMENT '유저 이름'
    , email VARCHAR(100) NOT NULL UNIQUE COMMENT '이메일'
    , loginPw VARCHAR(200) NOT NULL COMMENT '비밀번호'
    , `nickname` VARCHAR(50) NOT NULL UNIQUE COMMENT '유저 닉네임'
    , authPath VARCHAR(100) COMMENT '뭐로 로그인햇어? / 소셜로그인일 경우'
    , regDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '가입일'
    , `status` TINYINT NOT NULL DEFAULT 1 COMMENT '1: 정상 0: 탈퇴유예'
);