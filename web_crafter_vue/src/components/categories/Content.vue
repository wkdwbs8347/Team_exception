<script>
import * as Blockly from 'blockly'
import { pythonGenerator } from 'blockly/python'

// ===== Content ì¹´í…Œê³ ë¦¬ ë©”íƒ€ë°ì´í„° =====
export const category = {
  label: 'ì½˜í…ì¸ ',
  color: '#00c853',
  icon: 'ğŸ§©'
}

// ===== Content íˆ´ë°•ìŠ¤ XML =====
export const toolbox = `
<xml>
  <block type="content_button"></block>
  <block type="content_text"></block>
  <block type="content_image"></block>
</xml>
`

// ===== Content ë¸”ë¡ ì •ì˜ ë° ì½”ë“œ ìƒì„±ê¸° =====
export const defineBlocks = () => {
  // [1] ë²„íŠ¼
  if (!Blockly.Blocks['content_button']) {
    Blockly.Blocks['content_button'] = {
      init() {
        this.appendDummyInput()
            .appendField("ğŸ†— ë²„íŠ¼");
        this.appendDummyInput()
            .appendField("ì´ë¦„:")
            .appendField(new Blockly.FieldTextInput("ë²„íŠ¼"), "NAME");
        this.appendDummyInput()
            .appendField("ë¼ë²¨:")
            .appendField(new Blockly.FieldTextInput("í´ë¦­"), "LABEL");
        this.setPreviousStatement(true);
        this.setNextStatement(true);
        this.setColour('#00c853');
      }
    };
  }
  pythonGenerator.forBlock['content_button'] = (block) => {
    const label = block.getFieldValue('LABEL');
    const name = block.getFieldValue('NAME') || '';
    const safeName = name.replace(/\"/g, '&quot;');
    const classAttr = name ? ` class=\"${safeName}\"` : '';
    return `<button${classAttr} style=\"color:inherit\">${label}</button>\n`;
};


  // [2] í…ìŠ¤íŠ¸
  if (!Blockly.Blocks['content_text']) {
    Blockly.Blocks['content_text'] = {
      init() {
        this.appendDummyInput()
            .appendField("ğŸ“ í…ìŠ¤íŠ¸");
        this.appendDummyInput()
            .appendField("ì´ë¦„:")
            .appendField(new Blockly.FieldTextInput("í…ìŠ¤íŠ¸ ìš”ì†Œ"), "NAME");
        this.appendDummyInput()
            .appendField("ë‚´ìš©:")
            .appendField(new Blockly.FieldTextInput("ë‚´ìš©"), "TEXT");
        this.setPreviousStatement(true);
        this.setNextStatement(true);
        this.setColour('#00c853');
      }
    };
  }
  pythonGenerator.forBlock['content_text'] = (block) => {
    const text = block.getFieldValue('TEXT');
    const name = block.getFieldValue('NAME') || '';
    const safeName = name.replace(/\"/g, '&quot;');
    const classAttr = name ? ` class=\"${safeName}\"` : '';
    return `<p${classAttr}>${text}</p>\n`;
  };

  // [3] ì´ë¯¸ì§€
  if (!Blockly.Blocks['content_image']) {
    Blockly.Blocks['content_image'] = {
      init() {
        this.appendDummyInput()
            .appendField("ğŸ–¼ï¸ ì´ë¯¸ì§€");
        this.appendDummyInput()
            .appendField("ì´ë¦„:")
            .appendField(new Blockly.FieldTextInput("ì´ë¯¸ì§€ ìš”ì†Œ"), "NAME");
        this.appendDummyInput()
            .appendField("SRC:")
            .appendField(new Blockly.FieldTextInput("https://via.placeholder.com/150"), "SRC");
        this.setPreviousStatement(true);
        this.setNextStatement(true);
        this.setColour('#00c853');
      }
    };
  }
  pythonGenerator.forBlock['content_image'] = (block) => {
    const src = block.getFieldValue('SRC');
    const name = block.getFieldValue('NAME') || '';
    const safeName = name.replace(/\"/g, '&quot;');
    const classAttr = name ? ` class=\"${safeName}\"` : '';
    return `<img src=\"${src}\"${classAttr} style=\"max-width: 100%; border-radius: 8px;\" />\n`;
  };
}
</script>